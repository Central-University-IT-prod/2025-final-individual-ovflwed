# Архитектура приложения
## База данных
Как бд я выбрал Postgres. Вероятно для olap-операций будет лучше, использовать ClickHouse или другие OLAP-системы, но с учетом ограничения в 8 гб оперативной памяти, и непонятных ресурсов cpu, не рационально было бы использовать несколько баз. Также максимальная пропускная способность будет ограничена не бд, а неправильной архитектурой подачи данных: rest запросы для ml-скоров.

### Схема БД
![schema](../images/db.png)

Связи между сущностями отмечены на схеме

#### clients
Таблица клиентов
- client_id - уникальный идентификатор клиента
- login - логин клиента
- age - возраст клиента
- loc (сокращенное location) - позиция для таргетирования
- gender - пол - MALE, FEMALE

#### day
- day - день

#### migrations
Системная таблица для миграций
- id - уникальный идентификатор миграции
- migration_id - идентификатор миграции

#### advertisers
Таблица рекламодателей
- advertiser_id - уникальный идентификатор рекламодателя
- name - название рекламодателя

#### scores
Таблица ml-скоров
- advertiser_id - уникальный идентификатор рекламодателя
- client_id - уникальный идентификатор клиента
- score - ml-скор

#### campaigns
Таблица кампаний
- campaign_id - уникальный идентификатор кампании
- advertiser_id - уникальный идентификатор рекламодателя
- ad_title - название кампании
- ad_text - текст кампании
- start_date - дата начала кампании
- end_date - дата окончания кампании
- impressions_limit - лимит показов
- clicks_limit - лимит кликов
- cost_per_impression - стоимость показа
- cost_per_click - стоимость клика
- image_url - url картинки
- age_from - возраст от которого таргетировать
- age_to - возраст до которого таргетировать
- gender - пол - MALE, FEMALE или ALL
- loc - позиция для таргетирования
- is_deleted - флаг удаления кампании - нужен для view active_campaigns

#### impressions
Таблица показов
- campaign_id - уникальный идентификатор кампании
- client_id - уникальный идентификатор клиента
- day - день совершенного показа
- price - стоимость показа

#### clicks
Таблица кликов
- campaign_id - уникальный идентификатор кампании
- client_id - уникальный идентификатор клиента
- day - день совершенного клика
- price - стоимость клика

#### active_campaigns
Представление активных кампаний

## Архитектура сервисов

![arch](../images/arch.png)

Приложение пользуется редисом для кэширования текущего дня, redis самое популярное из решений для кэширования, особых разлчий memcached не дает в данном случае, поэтому я выбрал редис.

Выбор бд уже обоснован выше

Minio - хранилище файлов поддерживающее проткол S3, одно из самых популярных хранилищ. В случае необходимости, можно заменить на другое хранилище на интерфейсе S3.

Caddy - реверс-прокси, который управляет доступом к хранилишю. Позволяет получить безопасно предоставить доступ к хранилищу извне, например при необходимости добавить TLS сертификат.

Grafana - система визуализации данных, достаточно эффективна для визуализации метрик.

