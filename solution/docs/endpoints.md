## Эндпоинты
Подробно документация методов api приведена в swagger - http://{BASE_URL}/docs
- работа приложения начинается с ожидания healthcheck'ов перед запуском самого api, после чего запускаются миграции бд, после чего api стартует. (проверить запуск api можно через http://{BASE_URL}/ping)
- для взаимодействия с сервисом рекламмы нам необходимо создать некторых клиентов и кампании, после чего можно создать рекламные объявления(в том числе с изображением), обрабатывать ml-скоры.
- через запросы на http://{BASE_URL}/ads передавая клиента в параметры, мы можем получать таргетированую рекламу. также можем зафиксировать клик на объявление через http://{BASE_URL}/ads/{ad_id}/click
- для просмотра статистики по объявлениям можно использовать методы статистики api (секция Statistics в swagger) или дэшбоард (http://{BASE_URL}:3000), для входа в дэшбоард используется логин/пароль: admin/admin и открыв вкладку dashboards -> Prod -> Сервис рекламы увидим графики показаные далее на скриншотах.

### Клиенты
- `POST /clients/bulk` - массовое создание или обновление клиентов, в теле принимает список клиентов в форматe указанном ниже, может вернуть код 400 при неверных данных (например, поле `client_id` не соответствует формату uuid, поле `age` отрицательное). В случае успеха возвращает список созданных/обновленных клиентов в аналогичном формате.
    ```json
    [
        {
        "age": 0,
        "client_id": "3fa85f64-5717-4562-b3fc-2c963f66afa6",
        "gender": "MALE",
        "location": "string",
        "login": "string"
        } 
    ]
    ```
- `GET /clients/{client_id}` - получение информации о клиенте, возвращает данные в виде json словаря, ошибку 404 при отсутствии по указанному id или 400 при неверном формате id
    ```json
    {
        "age": 0,
        "client_id": "3fa85f64-5717-4562-b3fc-2c963f66afa6",
        "gender": "MALE",
        "location": "string",
        "login": "string"
    }
    ```

### Рекламодатели
- `POST /advertisers/bulk` - массовое создание или обновление рекламодателе (аналогично /clients/bulk), принимает и возвращает список созданных/обновленных рекламодателей в аналогичном формате:
    ```json
    [
        {
            "advertiser_id": "3fa85f64-5717-4562-b3fc-2c963f66afa6",
            "name": "string"
        }
    ]
    ```
- `GET /advertisers/{advertiser_id}` - аналогично /clients/{client_id}, возвращает данные в виде json словаря
    ```json
    {
        "advertiser_id": "3fa85f64-5717-4562-b3fc-2c963f66afa6",
        "name": "string"
    }
    ```
- `/ml-scores` - создает или обновляет ml-score по паре клиента и рекламодателя, в теле принимает json в формате, возвращает 400 при неверных данных и 404 при отсутствии по указанному id клиента или рекламодателя:
    ```json
    {
        "client_id": "3fa85f64-5717-4562-b3fc-2c963f66afa6",
        "advertiser_id": "3fa85f64-5717-4562-b3fc-2c963f66afa6",
        "score": 0
    }
    ```
### Объявления
- `POST /advertisers/{advertiser_id}/campaigns` - создание кампании, от данного рекламодателя, принимает данные в виде json словаря, возвращает данные в аналогичном формате с добавлением id кампании и рекламодателя и image_url = null, в случае успеха возвращает 201, 400 при неверных данных, 404 при отсутствии по указанному id рекламодателя:
    ```json
    {
        "ad_text": "string",
        "ad_title": "string",
        "clicks_limit": 0,
        "cost_per_click": 0,
        "cost_per_impression": 0,
        "end_date": 0,
        "impressions_limit": 0,
        "start_date": 0,
        "targeting": {
            "age_from": 0,
            "age_to": 0,
            "gender": "MALE",
            "location": "string"
        }
    }
    ```
- `GET /advertisers/{advertiser_id}/campaigns` - возвращает список всех кампаний данного рекламодателя c пагинацией (page, size, по умолчанию page=0, size=10), возвращает список из данных в аналогичном формате, в случае отсутствия по указанному id рекламодателя возвращает 404, 400 при неверных данных и 200 при успехе.
- `GET /advertisers/{advertiser_id}/campaigns/{campaign_id}` - возвращает рекламную кампанию по совокупности ее id и id рекламодателя, при остутствии возвращает 404, 400 при неверных данных и 200 при успехе.
- `PUT /advertisers/{advertiser_id}/campaigns/{campaign_id}` - обновление рекламной кампании, возвращает 400 при неверных данных, 404 при отсутствии по указанному id кампании или рекламодателя и 200 при успехе. не переданные поля считаются за null, ссылку на изображение обновлять нельзя. также нельзя менять некоторые поля после старта кампании.
- `DELETE /advertisers/{advertiser_id}/campaigns/{campaign_id}` - совершает soft-delete кампании по совокупности ее id и id рекламодателя, при остутствии возвращает 404, 400 при неверных данных и 204 при успехе. в бд остается кампания с is_deleted = true.
- `POST /advertisers/{advertiser_id}/campaigns/{campaign_id}/image` - загружает изображение в рекламную кампанию (в S3), при остутствии таковой возвращает 404, 400 при неверных данных и 200 при успехе. принимает файл изображения в формате jpeg (.jpg, .jpeg) в поле file.
- `DELETE /advertisers/{advertiser_id}/campaigns/{campaign_id}/image` - удаляет изображение из рекламной кампании, но не из хранилища, т.к. она может понадобиться в будущем (например в случае судебного разбирательства), при остутствии кампании возвращает 404, 400 при неверных данных и 204 при успехе.

### Работа с рекламой
- `GET /ads?client_id=...` - выдает рекламу данному пользователю, в случае отсутствия возвращает 404, 400 при неверных данных и 200 при успехе.
- `POST /ads/{ad_id}/click` - фиксирует в бд клик по рекламме от пользователя, при остутствии возвращает 400 при попытке кликнуть на непоказанное рекламное объявление, 404 при отсутствии рекламного объявления и 204 при успехе. в теле запроса необходимо передать client_id.

Алгоритм поиска рекламы:
1. Поиск активной рекламмы, подходящей по таргетингу
2. Нормализация (min, max) цены и скора рекламмы
3. Выбор рекламмы с максимальным скором посчитаным как взвешенная нормализованных цен, скора и отклонения кликов и показов от цели

Все проходит в запросе к бд, т.к. это гарантированно быстрее, чем в коде приложения.

### Статистика
- `GET /stats/campaigns/{campaign_id}` - возвращает агрегированную статистику по рекламе, возвращает 400 при неверных данных, 404 при отсутствии по указанному id кампании и 200 при успехе, пример результата:
    ```json
      {
        "clicks_count": 0,
        "conversion": 0,
        "impressions_count": 0,
        "spent_clicks": 0,
        "spent_impressions": 0,
        "spent_total": 0
    }
    ```

- `GET /stats/advertisers/{advertiser_id}/campaigns` - аналогично, но по всем объявлениям рекламодателя
- `GET /stats/campaigns/{campaign_id}/daily` -  возвращает сгруппированую по дням статистику по объявлению, возвращает 400 при неверных данных, 404 при отсутствии по указанному id кампании и 200 при успехе, результатом является список словарей аналогичного вида с предыдущими 2, но с добавлением даты
- `GET /stats/advertisers/{advertiser_id}/daily` - аналогично, но по всем объявлениям рекламодателя
